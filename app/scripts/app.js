if('serviceWorker' in navigator)window.addEventListener('load',async()=>{try{const r=await navigator.serviceWorker.register('/sw.js');throw_error('Ready to work offline!', true); console.log('SW registered:',r.scope);if(r.waiting&&typeof throw_error==='function')throw_error('New version available - refresh to update', true);r.addEventListener('updatefound',()=>{const n=r.installing;if(!n)return;n.addEventListener('statechange',()=>{if(n.state==='installed'){if(navigator.serviceWorker.controller){typeof throw_error==='function'?throw_error('New version available - refresh to update', true):console.log('New version available - refresh to update', true);}else throw_error('Updated!', true)}})});}catch(e){console.error('SW reg failed:',e);throw_error("Failed to start service worker", false);}});