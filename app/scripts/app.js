if('serviceWorker' in navigator)window.addEventListener('load',async()=>{try{const r=await navigator.serviceWorker.register('/sw.js');console.log('SW registered:',r.scope);if(r.waiting&&typeof throw_error==='function')throw_error('There is a new update available');r.addEventListener('updatefound',()=>{const n=r.installing;if(!n)return;n.addEventListener('statechange',()=>{if(n.state==='installed'){if(navigator.serviceWorker.controller){typeof throw_error==='function'?throw_error('There is a new update available, refresh your page to get it'):console.log('New update available');}else console.log('Content cached for offline use.')}})});}catch(e){console.error('SW reg failed:',e);}});